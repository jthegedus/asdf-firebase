#!/usr/bin/env bash

set -euo pipefail

# shellcheck source=../lib/utils.bash
source "$(dirname "$0")/../lib/utils.bash"

function download() {
    local filename="firebase"
    local url
    url="$GH_REPO/releases/download/v${ASDF_INSTALL_VERSION}/firebase-tools-$(get_os)"

    printf "⏬  downloading %s\\n" "${filename}"
    status_code=$(curl -X GET \
        --write-out "%{http_code}" \
        --progress-bar \
        -Lo "${ASDF_DOWNLOAD_PATH}/${filename}" \
        "${url}")

    if [[ ${status_code} -eq 404 ]]; then
        fail "firebase-tools not found for version ${ASDF_INSTALL_VERSION}. Full version required, not just major version numbers."
        exit 1
    fi
    printf "✅  downloaded!\\n"
}

download
