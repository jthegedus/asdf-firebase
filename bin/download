#!/usr/bin/env bash

set -euo pipefail

# shellcheck source=../lib/utils.bash
source "$(dirname "$0")/../lib/utils.bash"
# shellcheck source=../lib/helpers.bash
source "$(dirname "$0")/../lib/helpers.bash"

function download() {
    local filename="firebase"
    local url
    url="$(get_github_repo)/releases/download/v${ASDF_INSTALL_VERSION}/firebase-tools-$(get_os_name)"

    log_info "‚è¨  downloading ${filename} ${ASDF_INSTALL_VERSION} from ${url}"
    status_code=$(curl -X GET \
        --write-out "%{http_code}" \
        --progress-bar \
        -Lo "${ASDF_DOWNLOAD_PATH}/${filename}" \
        "${url}")

    if [[ ${status_code} -eq 404 ]]; then
        log_failure_and_exit "firebase-tools not found for version ${ASDF_INSTALL_VERSION}. Full version required, not just major version numbers."
    fi
    log_success "downloaded!"
}

download
