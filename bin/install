#!/usr/bin/env bash

set -euo pipefail

# shellcheck source=../lib/utils.bash
source "$(dirname "$0")/../lib/utils.bash"

function install_firebase() {
    # if not asdf version with asdf_download_path then call download script here
    if [ -z "${ASDF_DOWNLOAD_PATH:-}" ]; then
        tmp_download_dir=$(mktemp -d -t 'asdf_firebase_XXXXXX')
        trap 'rm -rf "${tmp_download_dir}"' EXIT
        printf "run download script for older version of asdf\\n"
        export ASDF_DOWNLOAD_PATH="${tmp_download_dir}"

        # download
        bash "$(dirname "$0")/download"
    fi

    printf "ðŸš§  installing...\\n"
    # move executable
    mkdir -p "${ASDF_INSTALL_PATH}/bin"
    cp "${ASDF_DOWNLOAD_PATH}/firebase" "${ASDF_INSTALL_PATH}/bin"
    chmod +rx "${ASDF_INSTALL_PATH}/bin/firebase"
    # test executable
    test -x "${ASDF_INSTALL_PATH}/bin/firebase" || fail "Expected ${ASDF_INSTALL_PATH}/bin/firebase to be executable."
    printf "âœ…  firebase-tools %s installed!\\n" "${ASDF_INSTALL_VERSION}"
}

if [ "${ASDF_INSTALL_TYPE}" != "version" ]; then
    fail "Please provide the firebase-tools version number you wish to install."
fi

install_firebase
